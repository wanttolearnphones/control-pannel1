<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Ritters Control Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --bg-color: #111;
      --text-color: white;
      --btn-bg: linear-gradient(to right, #333, #111);
      --btn-hover-bg: linear-gradient(to right, #555, #222);
    }
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
    }
    header {
      padding: 1em;
      text-align: center;
      background: var(--btn-bg);
    }
    main {
      display: grid;
      gap: 1em;
      padding: 1em;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    }
    section {
      background: rgba(255, 255, 255, 0.05);
      padding: 1em;
      border-radius: 10px;
      box-shadow: 0 0 5px rgba(0,0,0,0.5);
    }
    input, textarea, button, select {
      width: 100%;
      padding: 0.5em;
      margin-top: 0.5em;
      border: none;
      border-radius: 5px;
    }
    button {
      background: var(--btn-bg);
      color: white;
      cursor: pointer;
    }
    button:hover {
      background: var(--btn-hover-bg);
    }
    .laps {
      font-size: 0.9em;
      margin-top: 0.5em;
      max-height: 150px;
      overflow-y: auto;
    }
    audio {
      width: 100%;
      margin-top: 0.5em;
    }
    .weather-result {
      margin-top: 0.5em;
      font-size: 0.9em;
    }
  </style>
</head>
<body>

<header>
  <h1>Ritters Control Panel</h1>
  <button id="themeToggle">Toggle Dark/Light</button>
</header>

<main>
  <!-- Journal -->
  <section>
    <h2>Journal</h2>
    <textarea id="journalText" placeholder="Write your journal..."></textarea>
    <button onclick="saveJournal()">Save</button>
    <div id="journalSaved"></div>
  </section>

  <!-- Notes -->
  <section>
    <h2>Notes</h2>
    <textarea id="notesText" placeholder="Write your notes..."></textarea>
    <button onclick="saveNotes()">Save</button>
    <div id="notesSaved"></div>
  </section>

  <!-- Calendar -->
  <section>
    <h2>Calendar</h2>
    <input type="date" id="calendarDate">
    <textarea id="calendarEvent" placeholder="Event details..."></textarea>
    <button onclick="saveEvent()">Save Event</button>
    <div id="calendarSaved"></div>
  </section>

  <!-- Stopwatch -->
  <section>
    <h2>Stopwatch</h2>
    <div id="stopwatchDisplay">00:00:00.000</div>
    <button onclick="startStopwatch()">Start</button>
    <button onclick="stopStopwatch()">Stop</button>
    <button onclick="resetStopwatch()">Reset</button>
    <button onclick="lapStopwatch()">Lap</button>
    <div class="laps" id="lapsList"></div>
  </section>

  <!-- Music Player -->
  <section>
    <h2>Music Player</h2>
    <input type="file" id="musicFile" accept="audio/*">
    <audio id="musicPlayer" controls></audio>
  </section>

  <!-- Weather -->
  <section>
    <h2>Weather</h2>
    <input type="text" id="weatherCity" placeholder="Enter city">
    <button onclick="getWeather()">Get Weather</button>
    <div class="weather-result" id="weatherResult"></div>
  </section>
</main>

<script>
  /* ===== GLOBAL VARIABLES ===== */
  const weatherApiKey = "bc35dc734bb6fb3c973c5c4de9d0c0e2"; // Replace with your OpenWeatherMap API key

  /* ===== THEME TOGGLE ===== */
  const themeToggle = document.getElementById('themeToggle');
  themeToggle.addEventListener('click', () => {
    if (document.documentElement.style.getPropertyValue('--bg-color') === '#111') {
      document.documentElement.style.setProperty('--bg-color', '#fff');
      document.documentElement.style.setProperty('--text-color', '#000');
    } else {
      document.documentElement.style.setProperty('--bg-color', '#111');
      document.documentElement.style.setProperty('--text-color', 'white');
    }
  });

  /* ===== JOURNAL ===== */
  function saveJournal() {
    const text = document.getElementById('journalText').value;
    localStorage.setItem('journal', text);
    document.getElementById('journalSaved').innerText = "Saved!";
  }
  document.getElementById('journalText').value = localStorage.getItem('journal') || "";

  /* ===== NOTES ===== */
  function saveNotes() {
    const text = document.getElementById('notesText').value;
    localStorage.setItem('notes', text);
    document.getElementById('notesSaved').innerText = "Saved!";
  }
  document.getElementById('notesText').value = localStorage.getItem('notes') || "";

  /* ===== CALENDAR ===== */
  function saveEvent() {
    const date = document.getElementById('calendarDate').value;
    const event = document.getElementById('calendarEvent').value;
    let events = JSON.parse(localStorage.getItem('calendarEvents') || "{}");
    events[date] = event;
    localStorage.setItem('calendarEvents', JSON.stringify(events));
    document.getElementById('calendarSaved').innerText = "Event Saved!";
  }

  /* ===== STOPWATCH ===== */
  let stopwatchInterval, startTime, elapsedTime = 0;
  function updateStopwatch() {
    const time = Date.now() - startTime + elapsedTime;
    const ms = time % 1000;
    const sec = Math.floor(time / 1000) % 60;
    const min = Math.floor(time / (1000 * 60)) % 60;
    const hr = Math.floor(time / (1000 * 60 * 60));
    document.getElementById('stopwatchDisplay').innerText =
      `${String(hr).padStart(2,'0')}:${String(min).padStart(2,'0')}:${String(sec).padStart(2,'0')}.${String(ms).padStart(3,'0')}`;
  }
  function startStopwatch() {
    startTime = Date.now();
    stopwatchInterval = setInterval(updateStopwatch, 10);
  }
  function stopStopwatch() {
    clearInterval(stopwatchInterval);
    elapsedTime += Date.now() - startTime;
  }
  function resetStopwatch() {
    clearInterval(stopwatchInterval);
    elapsedTime = 0;
    document.getElementById('stopwatchDisplay').innerText = "00:00:00.000";
    document.getElementById('lapsList').innerHTML = "";
  }
  function lapStopwatch() {
    const lapTime = document.getElementById('stopwatchDisplay').innerText;
    const lapDiv = document.createElement('div');
    lapDiv.innerText = lapTime;
    document.getElementById('lapsList').appendChild(lapDiv);
  }

  /* ===== MUSIC PLAYER ===== */
  document.getElementById('musicFile').addEventListener('change', function() {
    const file = this.files[0];
    if (file) {
      const url = URL.createObjectURL(file);
      document.getElementById('musicPlayer').src = url;
    }
  });

  /* ===== WEATHER ===== */
  async function getWeather(lat = null, lon = null) {
    let city = document.getElementById('weatherCity').value;
    let url = "";
    if (lat && lon) {
      url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${weatherApiKey}&units=metric`;
    } else if (city) {
      url = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${weatherApiKey}&units=metric`;
      localStorage.setItem('lastWeatherCity', city);
    }
    const res = await fetch(url);
    const data = await res.json();
    if (data.cod === 200) {
      document.getElementById('weatherResult').innerText =
        `${data.name}: ${data.main.temp}Â°C, ${data.weather[0].description}`;
    } else {
      document.getElementById('weatherResult').innerText = "City not found.";
    }
  }

  // Auto-load last searched city
  window.addEventListener("load", () => {
    const lastCity = localStorage.getItem("lastWeatherCity");
    if (lastCity) {
      document.getElementById("weatherCity").value = lastCity;
      getWeather();
    } else {
      // Try auto-detect location
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          pos => getWeather(pos.coords.latitude, pos.coords.longitude),
          () => document.getElementById('weatherResult').innerText = "Location permission denied."
        );
      }
    }
  });
</script>

</body>
</html>